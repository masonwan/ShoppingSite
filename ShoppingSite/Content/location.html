<!DOCTYPE html>
<head>
<link rel="stylesheet" type="text/css" href="style.css" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Welcome to Shopping.com</title>

<!--[if IE]>
	<script src="js/html5.js"></script><![endif]-->
<!--[if lte IE 7]>
	<script src="js/IE8.js" type="text/javascript"></script><![endif]-->
<!--[if lt IE 7]>
	<link rel="stylesheet" type="text/css" media="all" href="css/ie6.css"/><![endif]-->
<!--[if lt IE 9]>
  <link type="text/css" href="css/movingboxes-ie.css" rel="stylesheet" media="screen" />
  <![endif]-->



</head>

<body >
<section id="container">
	
	<header id="header">
		<div id="header-in">
        	<aside class="logo"><a href="index.html"><img src="images/logo.png" /></a></aside>
        
        <aside class="top-links margnleft342"><a href="login.html">Sign In</a><strong style="font-weight:normal; font-size:12px;">|</strong>    <a href="signup.html">Sign Up</a></aside>
        
        <aside class="serch-box">

<input class="input1 left" type="text" value="Store Locator"  onFocus="if (this.value == 'Store Locator') {this.value = '';}" onBlur="if (this.value == '') {this.value = 'Store Locator';}"/>
<a href="#" class="left"><img src="images/search-icone.png" align="absmiddle" /></a>
</aside>

		<nav id="navgation">
    <ul>
        <li><a class="home" href="index.html"></a></li>
        <li><a class="means" href="products.html"></a></li>
        <li><a class="women" href="products.html"></a></li>
        <li><a class="boy" href="products.html"></a></li>
        <li><a class="girl" href="products.html"></a></li>
        <li><a class="sale" href="products.html"></a></li>
    </ul>
</nav>
<aside class="clear"></aside>
	<nav id="nav-bot">

<div class="right marright40">
  <a href="checkout.html"><img src="images/icone2.png" hspace="2" align="absmiddle" />My Cart: <strong>2 Items</strong></a>
</div>  
  
          <select name="select" id="select" class="select1 left">
          <option>Departments</option>
            <option>Departments</option>
              <option>Departments</option>
                <option>Departments</option>
                  <option>Departments</option>
          </select>


        <input class="input2 left marleft22" type="text" value="Search" name="email2" id="email2" onFocus="if (this.value == 'Search') {this.value = '';}" onBlur="if (this.value == '') {this.value = 'Search';}"/> 
      
 
<a href="#" class="marleft5"><img src="images/btn-search.png" /></a>

	</nav>
	</div>
    <aside class="clear"></aside>
    
	</header>
    
    <div id="content" >
    	<aside class="white-box-top"></aside>
        <aside class="white-box-middle">
          <aside class="check-wrap">
        		<img src="images/location.jpg">
            <div class="clear">&nbsp;</div><br>
                	<aside class="loc-head">
                    	<ul>
                        	<li>
                            	
                                
                                <aside class="width300 left">Store Name</aside>
                                <aside class="width130 left">Distance</aside>
                                
                            </li>
                    	</ul>
                    </aside>
                    
                    <aside class="loc-info" id='nearest'>
					
            </aside>
  










<aside class="map">
 <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <article>
      <p style="color:#fff; font-size:1px; text-indent:2000px; margin-top:-4px;">Finding your location: <span id="status">checking...</span></p>
    </article> 
    <article class="clear">&nbsp;</article>
<script>

var getStores, stores;
var tempstores = []; 
 var map;

stores = [
  {
    "Id": 3,
    "Name": "Albany",
    "Address": "1057 Eastshore Hwy Albany, CA 94710",
    "Latitude": 37.884581,
    "Longitude": -122.308017,
    "HasIndoor": true,
    "HasOutdoor": false,
    "HasStreet": false,
    "TaxRate": 3,
    "Phone": "(510) 982-0512"
  }, {
    "Id": 4,
    "Name": "Alhambra",
    "Address": "2120 W Main St Alhambra, CA 91801",
    "Latitude": 34.091086,
    "Longitude": -118.147144,
    "HasIndoor": false,
    "HasOutdoor": false,
    "HasStreet": false,
    "TaxRate": 7,
    "Phone": "(626) 308-3290"
  }, {
    "Id": 5,
    "Name": "Aliso Viejo",
    "Address": "26932 La Paz Rd Aliso Viejo, CA 92656",
    "Latitude": 33.571135,
    "Longitude": -117.705621,
    "HasIndoor": true,
    "HasOutdoor": false,
    "HasStreet": false,
    "TaxRate": 6,
    "Phone": "(949) 643-0337"
  }, {
    "Id": 6,
    "Name": "Anaheim",
    "Address": "101 S Euclid St Anaheim, CA 92802",
    "Latitude": 33.8324184,
    "Longitude": -117.9416126,
    "HasIndoor": true,
    "HasOutdoor": false,
    "HasStreet": false,
    "TaxRate": 3,
    "Phone": "(714) 422-1120"
  }, {
    "Id": 7,
    "Name": "Anaheim Hills",
    "Address": "8148 E Santa Ana Canyon Rd Anaheim, CA 92808",
    "Latitude": 33.8677213,
    "Longitude": -117.7473052,
    "HasIndoor": true,
    "HasOutdoor": true,
    "HasStreet": false,
    "TaxRate": 10.6,
    "Phone": "(714) 921-9091"
  }, {
    "Id": 8,
    "Name": "Antioch Slatten Ranch",
    "Address": "5769 Lone Tree Way Antioch, CA 94531",
    "Latitude": 38.964559,
    "Longitude": -121.737796,
    "HasIndoor": false,
    "HasOutdoor": true,
    "HasStreet": false,
    "TaxRate": 10.6,
    "Phone": "(925) 752-0002"
  }, {
    "Id": 9,
    "Name": "Apple Valley",
    "Address": "19201 Bear Valley Rd Apple Valley, CA 92308",
    "Latitude": 34.468974,
    "Longitude": -117.24352,
    "HasIndoor": true,
    "HasOutdoor": false,
    "HasStreet": true,
    "TaxRate": 7,
    "Phone": "(760) 247-4111"
  }, {
    "Id": 10,
    "Name": "Apple Valley North SuperTarget",
    "Address": "20288 US Hwy 18 Apple Valley, CA 92307",
    "Latitude": 34.527494,
    "Longitude": -117.217659,
    "HasIndoor": false,
    "HasOutdoor": false,
    "HasStreet": false,
    "TaxRate": 7,
    "Phone": "(760) 240-7654"
  }, {
    "Id": 11,
    "Name": "Atwater SuperTarget",
    "Address": "1000 Commerce Ave Atwater, CA 95301",
    "Latitude": 37.3421974,
    "Longitude": -120.6091341,
    "HasIndoor": true,
    "HasOutdoor": false,
    "HasStreet": true,
    "TaxRate": 9,
    "Phone": "(209) 357-4820"
  }, {
    "Id": 12,
    "Name": "Auburn",
    "Address": "2700 Bell Rd Auburn, CA 95603",
    "Latitude": 38.9422944,
    "Longitude": -121.0957483,
    "HasIndoor": true,
    "HasOutdoor": false,
    "HasStreet": false,
    "TaxRate": 10.6,
    "Phone": "(530) 889-5650"
  }, {
	 	"Id":13,
		"Name":"Azusa",
		"Address":"809 N Azusa Ave Azusa, CA 91702",
		"Latitude":34.1354808,
		"Longitude":-117.9075208,
		"HasIndoor":true,
		"HasOutdoor":false,
		"HasStreet":true,
		"TaxRate":9,
		"Phone":"(626) 629-1121"
 },	{
		"Id":14,
		"Name":"Bakersfield Central",
		"Address":"2901 Ming Ave Bakersfield, CA 93304",
		"Latitude":35.3384147,
		"Longitude":-119.0361199,
		"HasIndoor":false,
		"HasOutdoor":false,
		"HasStreet":false,
		"TaxRate":4.712,
		"Phone":"(661) 617-2000"
 },	{
		"Id":15,
		"Name":"Bakersfield NE",
		"Address":"3401 Mall View Rd Bakersfield, CA 93306",
		"Latitude":35.394718,
		"Longitude":-118.955605,
		"HasIndoor":true,
		"HasOutdoor":false,
		"HasStreet":true,
		"TaxRate":9.75,
		"Phone":"(661) 872-9929"
 },	{
		"Id":16,
		"Name":"Bakersfield NW",
		"Address":"9100 Rosedale Hwy Bakersfield, CA 93312",
		"Latitude":35.385061,
		"Longitude":-119.103272,
		"HasIndoor":true,
		"HasOutdoor":true,
		"HasStreet":true,
		"TaxRate":3,
		"Phone":"(661) 589-0554"
 },	{
		"Id":17,
		"Name":"Bakersfield West",
		"Address":"11000 Stockdale Hwy Bakersfield, CA 93311",
		"Latitude":35.349898,
		"Longitude":-119.125287,
		"HasIndoor":false,
		"HasOutdoor":false,
		"HasStreet":true,
		"TaxRate":9.75,
		"Phone":"(661) 617-3657"
 }, {
		"Id":18,
		"Name":"Baldwin Park",
		"Address":"3100 Baldwin Park Blvd Baldwin Park, CA 91706",
		"Latitude":34.069772,
		"Longitude":-117.977181,
		"HasIndoor":true,
		"HasOutdoor":true,
		"HasStreet":false,
		"TaxRate":11.5,
		"Phone":"(626) 851-9404"
 },	{
		"Id":19,
		"Name":"Brea",
		"Address":"855 E Birch St Brea, CA 92821",
		"Latitude":33.9178932,
		"Longitude":-117.887668,
		"HasIndoor":false,
		"HasOutdoor":true,
		"HasStreet":false,
		"TaxRate":10.6,
		"Phone":"(714) 989-5013"
 },	{
		"Id":20,
		"Name":"Buena Park",
		"Address":"7530 Orangethorpe Ave Buena Park, CA 90621",
		"Latitude":33.857341,
		"Longitude":-118.00091,
		"HasIndoor":false,
		"HasOutdoor":false,
		"HasStreet":true,
		"TaxRate":7,
		"Phone":"(714) 676-0013"
 }
];

getStores = function() {
  //return console.log("This code will be implemented in practice");
};

//console.log("Total store is " + store.lenght);

//console.log(stores);

function getNearestStore(user_latitude, user_longitude)
{	
	tempstore = '';
	var t = 1;
	for(x in stores)
	{
		distance = calculateDistance(user_latitude, user_longitude,stores[x].Latitude, stores[x].Longitude);
		tempstore = {
    		"Id": stores[x].Id,
    		"Name": stores[x].Name,
    		"Address": stores[x].Address,
    		"Latitude": stores[x].Latitude,
    		"Longitude": stores[x].Longitude,
			"HasIndoor": stores[x].HasIndoor,
			"HasOutdoor": stores[x].HasOutdoor,
			"HasStreet": stores[x].HasStreet,
			"TaxRate": stores[x].TaxRate,
			"Phone": stores[x].Phone,
			"Distance": distance
		  }
		  tempstores.push(tempstore);		
	}	
	
	
	
	tempstores.sort(function(a,b) { return parseFloat(a.Distance) - parseFloat(b.Distance) } );
	var store_list = '<ul>';
    var st = document.querySelector('#nearest');
	addMarker(user_latitude, user_longitude, t);                    	
	for(x1 in tempstores)
	{		
		store_list= store_list+'<li><aside class="width300 left"><strong class="txt14">'+tempstores[x1].Name+'</strong><br>'+tempstores[x1].Address+'<br>'+tempstores[x1].Phone+'</aside><aside class="width130 left">'+tempstores[x1].Distance+' miles<br><a href="#" class="left mart-10">Show me the direction</a></aside><div class="clear">&nbsp;</div><strong>Parking</strong><div class="clear"></div><aside class="parking"><img src="images/right.png" class="absmiddle"> Indoor<img src="images/right.png" class="absmiddle marl-30"> Outdoor<img src="images/right.png" class="absmiddle marl-30"> Street</aside></li>';
		++t;
		addMarker(tempstores[x1].Latitude, tempstores[x1].Longitude, t);		
		if(t>10)
		{
			break;
		}
		
		
	}
	store_list= store_list+'</ul>';	
	st.innerHTML = store_list;
}

function success(position) {
  var s = document.querySelector('#status');
  
  if (s.className == 'success') {
    // not sure why we're hitting this twice in FF, I think it's to do with a cached result coming back    
    return;
  }
  
  s.innerHTML = "Found you!";
  s.className = 'success';
  
  var mapcanvas = document.createElement('div');
  mapcanvas.id = 'mapcanvas';
  mapcanvas.style.height = '322px';
  mapcanvas.style.width = '370px';
    
  document.querySelector('article').appendChild(mapcanvas);

  var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
  var myOptions = {
    zoom: 15,
    center: latlng,
    mapTypeControl: false,
    navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
   map = new google.maps.Map(document.getElementById("mapcanvas"), myOptions);
  
 /* var marker = new google.maps.Marker({
      position: latlng, 
      map: map, 
      title:"You are here!"
  });*/
  
  getNearestStore(position.coords.latitude, position.coords.longitude);
  
}
 function addMarker(lat, lng, j) 
	{
		var markerimage = "images/pink-dot.png";
		if(j==1)
		{
			markerimage = "images/blue-dot.png";
		}
      // Create the marker
      var marker = new google.maps.Marker({
        position: new google.maps.LatLng(lat, lng),
        map: map,
		icon: markerimage
      });
	  
		
	  
	 }
 function rad(x)
  { 
  	return x * Math.PI / 180 
  }
 function calculateDistance(user_latitude, user_longitude,store_latitude, store_longitude)
 {
    var R = 6371;
    var dLat  = rad(store_latitude - user_latitude)
    var dLong = rad(store_longitude - user_longitude)

    var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(rad(user_latitude)) * Math.cos(rad(store_latitude)) * Math.sin(dLong/2) * Math.sin(dLong/2)
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a))
    var d = R * c
	d = (d/1.6);
	//alert(d);
    return Math.round(d)
  }

/*function calculateDistance(user_latitude, user_longitude,store_latitude, store_longitude)
{
	try
	{
		var glatlng1 = new GLatLng(user_latitude, user_longitude);
		var glatlng2 = new GLatLng(store_latitude, store_longitude);
		var miledistance = glatlng1.distanceFrom(glatlng2, 3959).toFixed(1);
		//var kmdistance = (miledistance * 1.609344).toFixed(1);
 alert(miledistance);
		//document.getElementById('results').innerHTML = '<strong>Address 1: </strong>' + location1.address + '<br /><strong>Address 2: </strong>' + location2.address + '<br /><strong>Distance: </strong>' + miledistance + ' miles (or ' + kmdistance + ' kilometers)';
	}
	catch (error)
	{
		alert(error);
	}
}*/


function error(msg) {
  var s = document.querySelector('#status');
  s.innerHTML = typeof msg == 'string' ? msg : "failed";
  s.className = 'fail';
  
  // console.log(arguments);
}

if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(success, error);
} else {
  error('not supported');
}


</script>


<script>

var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>
try {
var pageTracker = _gat._getTracker("UA-1656750-18");
pageTracker._trackPageview();
} catch(err) {}

</script>
    
    </aside>
                    
                <div class="clear">&nbsp;</div><br><br>
                
          </aside>
            
                        
        </aside>
        <aside class="white-box-bottom"></aside>
      <div class="clear"></div>
    </div>
    
    <section id="footer">

<div class="footer-in"><span class="right">Shopping.com © 2011</a></span><a href="#">Home</a> <strong style="font-size:12px; font-weight:normal;">|</strong> <a href="#">About Us</a><strong style="font-size:12px; font-weight:normal;"> |</strong> <a href="location.aspx">Contact Us</a> <strong style="font-size:12px; font-weight:normal;">|</strong> <a href="#">Terms of Service</a> <strong style="font-size:12px; font-weight:normal;">|</strong> <a href="#">Privacy Policy</a>
	
	
    </div>






</section>
    

<aside class="clear"></aside>
</section>
</body>
</html>
